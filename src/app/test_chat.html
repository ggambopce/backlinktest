<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>웹소켓 채팅 테스트</title>
</head>
<body>
<h1>웹소켓 채팅 테스트</h1>

<label>
    닉네임:
    <input id="nickname" value="user1" />
</label>
<br />
<label>
    메시지:
    <input id="messageInput" />
</label>
<button id="sendBtn">보내기</button>

<pre id="log" style="border: 1px solid #ccc; padding: 8px; height: 200px; overflow-y: scroll;"></pre>

<script>
    const logEl = document.getElementById('log');
    const nicknameInput = document.getElementById('nickname');
    const messageInput = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');

    function log(message) {
        logEl.textContent += message + '\n';
        logEl.scrollTop = logEl.scrollHeight;
    }

    // FastAPI 서버 주소에 맞게 수정
    const ws = new WebSocket("ws://localhost:8000/ws/chat");

    ws.onopen = () => {
        log("[시스템] 웹소켓 연결됨");
    };

    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        log(`${data.sender}: ${data.content}`);
    };

    ws.onclose = () => {
        log("[시스템] 웹소켓 연결 종료");
    };

    sendBtn.onclick = () => {
        const nickname = nicknameInput.value || "anonymous";
        const content = messageInput.value;
        if (!content) return;

        ws.send(JSON.stringify({
            sender: nickname,
            content: content,
        }));
        messageInput.value = "";
    };

    // 엔터키로 전송
    messageInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
            sendBtn.click();
        }
    });
</script>
</body>
</html>
